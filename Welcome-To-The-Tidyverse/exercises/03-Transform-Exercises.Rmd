---
title: "Transformando Datos"
---

```{r setup}
library(tidyverse)

# Toy datasets to use

pollution <- tribble(
       ~city,   ~size, ~amount, 
  "New York", "large",      23,
  "New York", "small",      14,
    "London", "large",      22,
    "London", "small",      16,
   "Beijing", "large",      121,
   "Beijing", "small",      56
)

# library(babynames)
```

# Importar datos

## Tu Turno 1

Mové el directorio de trabajo a `03-Transform`. Luego importá el dataset `babynames.csv` , which que está en la carpeta `03-Transform` como `babynames`. Copiá y pegá el código de importación al chunk de abajo. ¿Se ejecuta correctamente?

```{r}
library(readr)
setwd("~/Workspace/codium/tidyverse/remaster-the-tidyverse/Welcome-To-The-Tidyverse")
babynames <- read_csv("babynames.csv")
View(babynames)
```

```{r}
babynames
```

# dplyr

## Tu Turno 2

Modifica el código para seleccionar la columna `n`:

```{r}
select(babynames, name, prop)
```

## Pregunta

¿Cuál de las siguiente **NO** es una manera de seleccionar las columnas `name` y `n`?

```{r}
select(babynames, -c(year, sex, prop))
select(babynames, name:n)
select(babynames, starts_with("n"))
select(babynames, ends_with("n"))
```

## Tu Turno 3

Usá `filter`, `babynames`, y los operadores lógicos para encontrar:

* Todos los nombres donde prop es mayor o igual a 0.08
* Todos los niños llamados"Sea"  

```{r}

```

## Tu Turno 4

Usá los operadores booleanos para retornar solamente las filas que contengan:

* _Niños_ llamados Sue  
* Nombres que fueron usados exactamente por 5 o 6 niños en 1880
* Nombres que están entre: Acura, Lexus, or Yugo

```{r}

```

## Ayuda

¿Cuál es el menor valor de n?
¿Y el mayor?

```{r}

```

## Tu Turno 5

Usá `%>%` para escribir una secuencia de funciones que:

1. Filtre babynames a solo las niñas nacidas en 2017, *luego...*
2. Seleccione las columnas `name` y `n`, *entonces...*  
3. Ordene los resultados de modo que los nombres más populares queden arriba.

```{r}

```

## Tu Turno 6 - Examen

1. Filtra babynames a las filas que contengan un nombre y sexo dados
2. Selecciona solo las columnas que aparecerán en el gráfico final (no es estrictamente necesario, si útil en la práctica)
3. Grafica los resultados usando un gráfico de línea con `year` en el eje x y `prop` en el eje y

```{r}

```

## Tu Turno 7

Completá el código para extraer las filas donde el `name == “Khaleesi"`. Entonces usa `summarise()` y `sum()` y `min()` para encontrar:
1. El número total de niños llamados Khaleesi
2. El primer año en el cual Khaleesi aparece en el dataset


*(Pista: Aseguráte de borrar todos los `_` antes de ejecutar el código)*

```{r}
babynames ___ 
  filter(_______________________) ___
  ___________(total = ________, first = _______)
```

## Tu Turno 8

Completá el código con `group_by()`,`summarise()`, y `arrange()` para mostrar las diez combinaciones más comunes de name y sex. Calcular la popularidad como el total de niños con un nombre y sexo dados.

*(Pista: Aseguráte de borrar todos los `_` antes de ejecutar el código)*

```{r}
babynames %>%
  _______(name, sex) %>% 
  _______(total = _____(n)) %>% 
  _______(desc(_____))
```

## Tu Turno 9

1. Usá `group_by()` para calcular el número de niños nacidos por cada año. 
2. Graficá los resultados como un gráfico de línea: total vs año.

```{r}

```

## Tu Turno 10

Completá los espacios en blanco para:
Rankear cada nombre _por cada año y sexo_.

*(Pista: Aseguráte de borrar todos los `_` antes de ejecutar el código)*

```{r}
babynames %>% 
  group_by(____, ____) %>% 
  ______(rank = min_rank(____(prop)))
```

## Tu Turno 11

Completá los espacios en blanco para calcular la mediana por cada nombre (por cada combinación de `name` y `sexo`). Ordená los resultados teniendo en cuenta la mediana, de mayor a menor.

*(Pista: Aseguráte de borrar todos los `_` antes de ejecutar el código)*

```{r}
babynames %>% 
  group_by(year, sex) %>% 
  mutate(rank = min_rank(desc(prop))) %>% 
  group_by(____, ____) %>% 
  ________(median_rank = ______(_____)) %>% 
  arrange(median_rank)

```

***

# Resumen

* Extraé variables con `select()`  
* Extraé ocurrencias coh `filter()`  
* Ordená ocurrencias con `arrange()`  

* Hacé resúmenes de tablas con `summarise()`  
* Creá nuevas variables con `mutate()`  
* Hacé operaciones de agrupamiento con `group_by()`

* Conectá operaciones con `%>%`  


